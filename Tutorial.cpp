#include <graphics.h>
#include <cmath>
#include <iostream>
using namespace std;
const int max_it = 100;
const int max_x = 300; //this can be changed
const int max_y = 200;

int main()
{
	initwindow(max_x, max_y);
	double cr, ci;
	double scale = max_x / 3;
	double zoom = 1;
	double Re = -1.76938317919551501821384728608547378290574726365475143746552821652788819126475645883616344638952966730448582578182030315748749123842171940312824619511374752125508480620857874547728033032251679986623911241845427430171292144236397931692967543941816568313013426227935414237685724357839108499720568695273052075081914417347810617942906997531749111337143517341661174565202727561591789320429089324651026717908784146646282137559906504607383722834707778703064588828982026040017443489083888449628870745058537070958320394103234549205405343784060832025430020802407760006045108831364;
	double Im = 0.0042368479187367722149265071713679970766826709174037572794594356501123440008055451573024309950236365063135326833596525718230049480553873630612752481493929235593089283439205079672488790492198666604557662694690066610349401490471432372558697978990852065668320265806402411530037882678978639464162203534105510290045630572371868452721037732584630791751262877467200569332623280695382279675583251718887347912436143098948549550112409632942168282733069353217150536745552663738270698858345691568467320246221193738452348706529000462703727091280634533646900754641110966940;
	for (int i = 0; i < 100; i++)
	{
		for (int y = 0; y < max_y; y++) //coloring every pixel
		{
			for (int x = 0; x < max_x; x++)
			{
				//cr = (static_cast<double>(x) / (scale))  - 2 + Re;
				cr = 1.5 * (x - max_x / 2) / (0.5 * zoom * max_x) + Re;
				ci = (y - max_y / 2) / (0.5 * zoom * max_y) + Im;
				//ci = ((-1) * (static_cast<double>(y) / (scale)))  + 1 + Im;
				double old_zr, old_zi, new_zi, new_zr;
				int n = 0;
				old_zr = 0;
				old_zi = 0;
				new_zr = 0;
				new_zi = 0;
				for (n = 0; n < max_it; n++)
				{
					old_zr = new_zr;
					old_zi = new_zi;
					new_zr = old_zr * old_zr - old_zi * old_zi + cr;
					new_zi = 2 * old_zr * old_zi + ci;
					if ((new_zr * new_zr + new_zi * new_zi) > 4) break;
				}
				if (n == max_it) putpixel(x, y, BLACK);
				else
				{
					double q = sqrt(new_zr * new_zr + new_zi * new_zi);
					int brightness = 256 * log(1.75 + n - log(log(q)));
					putpixel(x, y, COLOR(brightness, brightness, 255));
				}
			}
		}
		std::cout << "zoom = " << zoom << " ";
		std::cout << "iteration = " << i << " ";
		zoom = (zoom+1)*i*0.5;
	}
	getch();
	closegraph();
}